{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///home/plv92/Desktop/TEK3/Epikodi/src/components/AudioQueueHUD.tsx"],"sourcesContent":["\"use client\"\nimport { useAudio } from \"@/context/AudioContext\"\n\nexport default function AudioQueueHUD() {\n  const { queue, playTrack, removeFromQueue } = useAudio()\n\n  if (queue.length === 0) return null\n\n  return (\n    <div className=\"fixed top-24 right-4 z-50 w-80 bg-gray-900/95 border border-gray-800 rounded-lg shadow-lg p-4\">\n      <h4 className=\"text-lg font-bold text-white mb-2\">File dâ€™attente</h4>\n      <ul className=\"space-y-2\">\n        {queue.map((track, i) => (\n          <li key={i} className=\"flex items-center gap-2 bg-gray-800 rounded p-2\">\n            <img src={track.cover || \"/default-cover.png\"} alt=\"\" className=\"w-10 h-10 object-cover rounded\" />\n            <div className=\"flex-1 min-w-0\">\n              <div className=\"truncate text-white\">{track.title}</div>\n              <div className=\"truncate text-xs text-gray-400\">{track.artist}</div>\n            </div>\n            <button\n              className=\"text-kodi-blue hover:underline text-xs\"\n              onClick={() => playTrack(track)}\n              title=\"Lire ce morceau\"\n            >Lire</button>\n            <button\n              className=\"text-red-400 hover:underline text-xs\"\n              onClick={() => removeFromQueue(i)}\n              title=\"Retirer de la file\"\n            >âœ•</button>\n          </li>\n        ))}\n      </ul>\n    </div>\n  )\n}"],"names":[],"mappings":";;;;AACA;;;AADA;;AAGe,SAAS;;IACtB,MAAM,EAAE,KAAK,EAAE,SAAS,EAAE,eAAe,EAAE,GAAG,CAAA,GAAA,kIAAA,CAAA,WAAQ,AAAD;IAErD,IAAI,MAAM,MAAM,KAAK,GAAG,OAAO;IAE/B,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAG,WAAU;0BAAoC;;;;;;0BAClD,6LAAC;gBAAG,WAAU;0BACX,MAAM,GAAG,CAAC,CAAC,OAAO,kBACjB,6LAAC;wBAAW,WAAU;;0CACpB,6LAAC;gCAAI,KAAK,MAAM,KAAK,IAAI;gCAAsB,KAAI;gCAAG,WAAU;;;;;;0CAChE,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCAAI,WAAU;kDAAuB,MAAM,KAAK;;;;;;kDACjD,6LAAC;wCAAI,WAAU;kDAAkC,MAAM,MAAM;;;;;;;;;;;;0CAE/D,6LAAC;gCACC,WAAU;gCACV,SAAS,IAAM,UAAU;gCACzB,OAAM;0CACP;;;;;;0CACD,6LAAC;gCACC,WAAU;gCACV,SAAS,IAAM,gBAAgB;gCAC/B,OAAM;0CACP;;;;;;;uBAfM;;;;;;;;;;;;;;;;AAqBnB;GA/BwB;;QACwB,kIAAA,CAAA,WAAQ;;;KADhC","debugId":null}},
    {"offset": {"line": 125, "column": 0}, "map": {"version":3,"sources":["file:///home/plv92/Desktop/TEK3/Epikodi/src/app/musique/page.tsx"],"sourcesContent":["\"use client\"\n\nimport { useEffect, useState } from \"react\"\nimport { useAudio } from \"@/context/AudioContext\"\nimport TrackItem from \"@/components/TrackItem\"\nimport AudioQueueHUD from \"@/components/AudioQueueHUD\"\n\ntype Track = {\n  id: number\n  title: string\n  artist: string\n  album?: string\n  url: string\n  createdAt: string\n  cover?: string\n  genre?: string\n  year?: number\n}\n\ntype JamendoTrack = {\n  id: string\n  name: string\n  artist_name: string\n  album_name: string\n  audio: string\n  album_image: string\n}\n\nexport default function MusiquePage() {\n  const [tracks, setTracks] = useState<Track[]>([])\n  const [jamendoTracks, setJamendoTracks] = useState<JamendoTrack[]>([])\n  const [search, setSearch] = useState(\"\")\n  const [message, setMessage] = useState<string | null>(null)\n  const { play, pause, isPlaying, volume, setVolume, queue, addToQueue, playTrack } = useAudio();\n\n  // Suppression d'un morceau\n  const handleDelete = async (id: number) => {\n    if (!confirm(\"Supprimer ce morceau ?\")) return\n    const res = await fetch(`/api/tracks/${id}`, { method: \"DELETE\" })\n    if (res.ok) setTracks(tracks => tracks.filter(t => t.id !== id))\n    else alert(\"Erreur lors de la suppression\")\n  }\n\n  useEffect(() => {\n    // Fetch local tracks\n    fetch(\"/api/tracks\")\n      .then(res => res.json())\n      .then(setTracks)\n    // Fetch Jamendo world hits\n    fetch(\"/api/world-hits\")\n      .then(res => res.json())\n      .then(setJamendoTracks)\n  }, [])\n\n  // Filtrage des morceaux selon la recherche\n  const filteredTracks = tracks.filter(track =>\n    track.title.toLowerCase().includes(search.toLowerCase()) ||\n    track.artist.toLowerCase().includes(search.toLowerCase()) ||\n    (track.album?.toLowerCase().includes(search.toLowerCase()) ?? false)\n  )\n\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.target instanceof HTMLInputElement || e.target instanceof HTMLTextAreaElement) return; // ignore si focus sur input\n      if (e.code === \"Space\") {\n        e.preventDefault();\n        isPlaying ? pause() : play();\n      }\n      if (e.code === \"ArrowUp\") {\n        e.preventDefault();\n        setVolume(Math.min(1, volume + 0.05));\n      }\n      if (e.code === \"ArrowDown\") {\n        e.preventDefault();\n        setVolume(Math.max(0, volume - 0.05));\n      }\n    };\n    window.addEventListener(\"keydown\", handleKeyDown);\n    return () => window.removeEventListener(\"keydown\", handleKeyDown);\n  }, [isPlaying, play, pause, volume, setVolume]);\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-kodi-blue/40 py-10\">\n      <div className=\"max-w-4xl mx-auto\">\n        <div className=\"flex justify-between items-center mb-8\">\n          <h2 className=\"text-3xl font-extrabold text-white drop-shadow\">ðŸŽµ Ma musique</h2>\n          <a\n            href=\"/musique/ajouter\"\n            className=\"bg-kodi-blue hover:bg-blue-700 text-white px-4 py-2 rounded shadow transition\"\n          >\n            + Ajouter un morceau\n          </a>\n        </div>\n\n        {/* Barre de recherche */}\n        <div className=\"mb-6\">\n          <input\n            type=\"text\"\n            placeholder=\"Rechercher un titre, artiste ou album...\"\n            value={search}\n            onChange={e => setSearch(e.target.value)}\n            className=\"w-full p-2 rounded bg-gray-800 text-white border border-gray-700\"\n          />\n        </div>\n\n        {/* Section locale */}\n        <h3 className=\"text-xl font-bold text-white mb-4\">Mes morceaux</h3>\n        {filteredTracks.length === 0 ? (\n          <p className=\"text-gray-400 text-center\">Aucun morceau trouvÃ©.</p>\n        ) : (\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-6 mb-10\">\n            {filteredTracks.map((track) => (\n              <TrackItem\n                key={track.id}\n                track={track}\n                onDelete={handleDelete}\n                onQueue={id => {\n                  const t = tracks.find(t => t.id === id)\n                  if (t) addToQueue(t)\n                }}\n                onPlay={track => play(track)}\n              />\n            ))}\n          </div>\n        )}\n\n        {/* Section mondiale Jamendo */}\n        <h3 className=\"text-xl font-bold text-white mb-4 mt-10\">Top musiques libres de droits</h3>\n        {jamendoTracks.length === 0 ? (\n          <p className=\"text-gray-400 text-center\">Chargement des musiques libres...</p>\n        ) : (\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-6\">\n            {jamendoTracks.map((track) => {\n              const jamendoAsTrack = {\n                id: Number(track.id),\n                title: track.name,\n                artist: track.artist_name,\n                album: track.album_name,\n                url: track.audio,\n                createdAt: \"\",\n                cover: track.album_image,\n                genre: \"\",\n                year: undefined,\n              };\n              // VÃ©rifie si dÃ©jÃ  dans la file\n              const isInQueue = queue.some(t => t.url === jamendoAsTrack.url);\n              // VÃ©rifie si dÃ©jÃ  dans la bibliothÃ¨que locale\n              const isInLibrary = tracks.some(t => t.url === jamendoAsTrack.url);\n\n              return (\n                <div key={track.id} className=\"bg-gray-700 rounded p-4 flex flex-col gap-1 shadow hover:bg-kodi-blue/80 transition\">\n                  {track.album_image ? (\n                    <img src={track.album_image} alt=\"cover\" className=\"w-32 h-32 object-cover rounded mb-2 mx-auto\" />\n                  ) : (\n                    <div className=\"w-32 h-32 bg-gray-600 rounded mb-2 mx-auto flex items-center justify-center text-gray-400\">Pas de cover</div>\n                  )}\n                  <div className=\"font-semibold text-lg\">{track.name}</div>\n                  <div className=\"text-sm text-gray-300\">{track.artist_name} â€” <span className=\"italic\">{track.album_name}</span></div>\n                  <div className=\"flex gap-2 mt-2\">\n                    <button\n                      className=\"bg-kodi-blue text-white px-2 py-1 rounded text-xs hover:bg-blue-700\"\n                      onClick={() => playTrack(jamendoAsTrack)}\n                    >\n                      Ã‰couter\n                    </button>\n                    <button\n                      className={`flex-1 bg-gray-600 text-white px-2 py-1 rounded text-xs hover:bg-gray-500 ${isInQueue ? \"opacity-50 cursor-not-allowed\" : \"\"}`}\n                      onClick={async () => {\n                        if (isInLibrary) return;\n                        const res = await fetch(\"/api/tracks\", {\n                          method: \"POST\",\n                          headers: {\n                            \"Content-Type\": \"application/json\",\n                          },\n                          body: JSON.stringify(jamendoAsTrack),\n                        });\n                        if (res.ok) {\n                          fetch(\"/api/tracks\")\n                            .then(res => res.json())\n                            .then(setTracks);\n                          setMessage(\"Morceau sauvegardÃ© !\");\n                          setTimeout(() => setMessage(null), 2000);\n                        } else {\n                          const data = await res.json();\n                          setMessage(data.error || \"Erreur lors de la sauvegarde\");\n                        }\n                      }}\n                    >\n                      {isInLibrary ? \"DÃ©jÃ  sauvegardÃ©\" : \"Sauvegarder\"}\n                    </button>\n                  </div>\n                </div>\n              )\n            })}\n          </div>\n        )}\n\n        {message && (\n          <div className={`mb-4 p-2 rounded text-center ${message.includes(\"sauvegardÃ©\") ? \"bg-green-700\" : \"bg-red-700\"} text-white`}>\n            {message}\n          </div>\n        )}\n      </div>\n      <AudioQueueHUD />\n    </div>\n  )\n}"],"names":[],"mappings":"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","debugId":null}}]
}