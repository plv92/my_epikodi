{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 84, "column": 0}, "map": {"version":3,"sources":["file:///home/plv92/Desktop/TEK3/Epikodi/src/utils/audioDb.ts"],"sourcesContent":["export async function fetchAudioDbMetadata(artist: string, track: string) {\n  const url = `https://theaudiodb.com/api/v1/json/2/searchtrack.php?s=${encodeURIComponent(\n    artist\n  )}&t=${encodeURIComponent(track)}`\n\n  const res = await fetch(url)\n  const data = await res.json()\n  if (data.track && data.track.length > 0) {\n    return data.track[0] // Contient cover, genre, album, etc.\n  }\n  return null\n}\n\nexport async function fetchWorldHits() {\n  // Ex: les 10 derniers singles ajoutés sur TheAudioDB\n  const url = \"https://theaudiodb.com/api/v1/json/2/trending.php?country=us&type=itunes&format=singles\"\n  const res = await fetch(url)\n  const data = await res.json()\n  return data.trending || []\n}"],"names":[],"mappings":";;;;AAAO,eAAe,qBAAqB,MAAc,EAAE,KAAa;IACtE,MAAM,MAAM,CAAC,uDAAuD,EAAE,mBACpE,QACA,GAAG,EAAE,mBAAmB,QAAQ;IAElC,MAAM,MAAM,MAAM,MAAM;IACxB,MAAM,OAAO,MAAM,IAAI,IAAI;IAC3B,IAAI,KAAK,KAAK,IAAI,KAAK,KAAK,CAAC,MAAM,GAAG,GAAG;QACvC,OAAO,KAAK,KAAK,CAAC,EAAE,CAAC,qCAAqC;;IAC5D;IACA,OAAO;AACT;AAEO,eAAe;IACpB,qDAAqD;IACrD,MAAM,MAAM;IACZ,MAAM,MAAM,MAAM,MAAM;IACxB,MAAM,OAAO,MAAM,IAAI,IAAI;IAC3B,OAAO,KAAK,QAAQ,IAAI,EAAE;AAC5B","debugId":null}},
    {"offset": {"line": 111, "column": 0}, "map": {"version":3,"sources":["file:///home/plv92/Desktop/TEK3/Epikodi/src/app/api/tracks/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { PrismaClient } from \"@prisma/client\"\nimport { writeFile } from \"fs/promises\"\nimport path from \"path\"\nimport { fetchAudioDbMetadata } from \"@/utils/audioDb\"\n\nconst prisma = new PrismaClient()\n\nexport async function GET() {\n  const tracks = await prisma.track.findMany({\n    orderBy: { createdAt: \"desc\" }\n  })\n  return NextResponse.json(tracks)\n}\n\nexport async function POST(req: NextRequest) {\n  let title = \"\"\n  let artist = \"\"\n  let album = \"\"\n  let url = \"\"\n  let cover = null\n  let genre = null\n  let year = null\n\n  // 1. Détecte le type de contenu\n  const contentType = req.headers.get(\"content-type\") || \"\"\n\n  if (contentType.includes(\"application/json\")) {\n    // --- Cas Jamendo ou ajout externe ---\n    const data = await req.json()\n    title = data.title\n    artist = data.artist\n    album = data.album || \"\"\n    url = data.url\n    cover = data.cover || null\n    genre = data.genre || null\n    year = data.year || null\n  } else if (contentType.includes(\"multipart/form-data\")) {\n    // --- Cas upload local ---\n    const formData = await req.formData()\n    const file = formData.get(\"file\") as File | null\n    title = formData.get(\"title\") as string\n    artist = formData.get(\"artist\") as string\n    album = formData.get(\"album\") as string\n\n    if (file && file.size > 0) {\n      const fileName = file.name.replace(/\\s/g, \"_\")\n      const bytes = await file.arrayBuffer()\n      const buffer = Buffer.from(bytes)\n      const filePath = path.join(process.cwd(), \"public\", \"music\", fileName)\n      await writeFile(filePath, buffer)\n      url = `/music/${fileName}`\n    }\n    // Optionnel : cover, genre, year depuis le formData si tu veux\n  }\n\n  // Optionnel : enrichir avec AudioDb si info manquante\n  try {\n    const meta = await fetchAudioDbMetadata(artist, title)\n    genre = genre || meta?.strGenre || null\n    year = year || meta?.intYearReleased || null\n    cover = cover || meta?.strTrackThumb || null\n  } catch (e) {\n    // non bloquant\n  }\n\n  if (!url || !title || !artist) {\n    return NextResponse.json({ error: \"Champs obligatoires manquants\" }, { status: 400 })\n  }\n\n  // Vérifie s'il existe déjà (par url ou par titre/artiste)\n  const existing = await prisma.track.findFirst({\n    where: {\n      OR: [\n        { url },\n        { AND: [{ title }, { artist }] }\n      ]\n    }\n  });\n  if (existing) {\n    return NextResponse.json({ error: \"Ce morceau existe déjà.\" }, { status: 409 });\n  }\n\n  // Enregistre la piste en BDD avec les métadonnées\n  const track = await prisma.track.create({\n    data: {\n      title,\n      artist,\n      album,\n      url,\n      cover,\n      genre,\n      year: year ? Number(year) : null,\n    },\n  })\n\n  return NextResponse.json(track)\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEA,MAAM,SAAS,IAAI,6HAAA,CAAA,eAAY;AAExB,eAAe;IACpB,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,QAAQ,CAAC;QACzC,SAAS;YAAE,WAAW;QAAO;IAC/B;IACA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;AAC3B;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI,QAAQ;IACZ,IAAI,SAAS;IACb,IAAI,QAAQ;IACZ,IAAI,MAAM;IACV,IAAI,QAAQ;IACZ,IAAI,QAAQ;IACZ,IAAI,OAAO;IAEX,gCAAgC;IAChC,MAAM,cAAc,IAAI,OAAO,CAAC,GAAG,CAAC,mBAAmB;IAEvD,IAAI,YAAY,QAAQ,CAAC,qBAAqB;QAC5C,uCAAuC;QACvC,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,QAAQ,KAAK,KAAK;QAClB,SAAS,KAAK,MAAM;QACpB,QAAQ,KAAK,KAAK,IAAI;QACtB,MAAM,KAAK,GAAG;QACd,QAAQ,KAAK,KAAK,IAAI;QACtB,QAAQ,KAAK,KAAK,IAAI;QACtB,OAAO,KAAK,IAAI,IAAI;IACtB,OAAO,IAAI,YAAY,QAAQ,CAAC,wBAAwB;QACtD,2BAA2B;QAC3B,MAAM,WAAW,MAAM,IAAI,QAAQ;QACnC,MAAM,OAAO,SAAS,GAAG,CAAC;QAC1B,QAAQ,SAAS,GAAG,CAAC;QACrB,SAAS,SAAS,GAAG,CAAC;QACtB,QAAQ,SAAS,GAAG,CAAC;QAErB,IAAI,QAAQ,KAAK,IAAI,GAAG,GAAG;YACzB,MAAM,WAAW,KAAK,IAAI,CAAC,OAAO,CAAC,OAAO;YAC1C,MAAM,QAAQ,MAAM,KAAK,WAAW;YACpC,MAAM,SAAS,OAAO,IAAI,CAAC;YAC3B,MAAM,WAAW,iGAAA,CAAA,UAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,UAAU,SAAS;YAC7D,MAAM,CAAA,GAAA,qHAAA,CAAA,YAAS,AAAD,EAAE,UAAU;YAC1B,MAAM,CAAC,OAAO,EAAE,UAAU;QAC5B;IACA,+DAA+D;IACjE;IAEA,sDAAsD;IACtD,IAAI;QACF,MAAM,OAAO,MAAM,CAAA,GAAA,yHAAA,CAAA,uBAAoB,AAAD,EAAE,QAAQ;QAChD,QAAQ,SAAS,MAAM,YAAY;QACnC,OAAO,QAAQ,MAAM,mBAAmB;QACxC,QAAQ,SAAS,MAAM,iBAAiB;IAC1C,EAAE,OAAO,GAAG;IACV,eAAe;IACjB;IAEA,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,QAAQ;QAC7B,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAgC,GAAG;YAAE,QAAQ;QAAI;IACrF;IAEA,0DAA0D;IAC1D,MAAM,WAAW,MAAM,OAAO,KAAK,CAAC,SAAS,CAAC;QAC5C,OAAO;YACL,IAAI;gBACF;oBAAE;gBAAI;gBACN;oBAAE,KAAK;wBAAC;4BAAE;wBAAM;wBAAG;4BAAE;wBAAO;qBAAE;gBAAC;aAChC;QACH;IACF;IACA,IAAI,UAAU;QACZ,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA0B,GAAG;YAAE,QAAQ;QAAI;IAC/E;IAEA,kDAAkD;IAClD,MAAM,QAAQ,MAAM,OAAO,KAAK,CAAC,MAAM,CAAC;QACtC,MAAM;YACJ;YACA;YACA;YACA;YACA;YACA;YACA,MAAM,OAAO,OAAO,QAAQ;QAC9B;IACF;IAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;AAC3B","debugId":null}}]
}