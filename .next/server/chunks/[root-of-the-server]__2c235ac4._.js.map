{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///home/plv92/Desktop/TEK3/Epikodi/src/app/api/stats/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { PrismaClient } from \"@prisma/client\";\n\nconst prisma = new PrismaClient();\n\n// GET /api/stats - Récupère les statistiques d'écoute\nexport async function GET() {\n  try {\n    // Top tracks\n    const topTracks = await prisma.listeningHistory.groupBy({\n      by: ['trackId'],\n      _count: {\n        trackId: true,\n      },\n      orderBy: {\n        _count: {\n          trackId: 'desc',\n        },\n      },\n      take: 10,\n    });\n\n    // Enrichir avec les infos des tracks\n    const topTracksWithInfo = await Promise.all(\n      topTracks.map(async (item) => {\n        const track = await prisma.track.findUnique({\n          where: { id: item.trackId },\n        });\n        return {\n          track,\n          playCount: item._count.trackId,\n        };\n      })\n    );\n\n    // Stats générales\n    const totalListens = await prisma.listeningHistory.count();\n    const uniqueTracks = await prisma.listeningHistory.findMany({\n      distinct: ['trackId'],\n    });\n\n    // Écoutes par jour (7 derniers jours)\n    const sevenDaysAgo = new Date();\n    sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);\n\n    const recentListens = await prisma.listeningHistory.findMany({\n      where: {\n        listenedAt: {\n          gte: sevenDaysAgo,\n        },\n      },\n      orderBy: {\n        listenedAt: 'asc',\n      },\n    });\n\n    // Grouper par jour\n    const listensByDay = recentListens.reduce((acc: any, listen) => {\n      const day = listen.listenedAt.toISOString().split('T')[0];\n      acc[day] = (acc[day] || 0) + 1;\n      return acc;\n    }, {});\n\n    return NextResponse.json({\n      topTracks: topTracksWithInfo,\n      totalListens,\n      uniqueTracks: uniqueTracks.length,\n      listensByDay,\n    });\n  } catch (error) {\n    console.error(\"Erreur API stats:\", error);\n    return NextResponse.json({\n      topTracks: [],\n      totalListens: 0,\n      uniqueTracks: 0,\n      listensByDay: {},\n    }, { status: 200 });\n  }\n}\n"],"names":[],"mappings":";;;AAAA;AACA;;;AAEA,MAAM,SAAS,IAAI,6HAAA,CAAA,eAAY;AAGxB,eAAe;IACpB,IAAI;QACF,aAAa;QACb,MAAM,YAAY,MAAM,OAAO,gBAAgB,CAAC,OAAO,CAAC;YACtD,IAAI;gBAAC;aAAU;YACf,QAAQ;gBACN,SAAS;YACX;YACA,SAAS;gBACP,QAAQ;oBACN,SAAS;gBACX;YACF;YACA,MAAM;QACR;QAEA,qCAAqC;QACrC,MAAM,oBAAoB,MAAM,QAAQ,GAAG,CACzC,UAAU,GAAG,CAAC,OAAO;YACnB,MAAM,QAAQ,MAAM,OAAO,KAAK,CAAC,UAAU,CAAC;gBAC1C,OAAO;oBAAE,IAAI,KAAK,OAAO;gBAAC;YAC5B;YACA,OAAO;gBACL;gBACA,WAAW,KAAK,MAAM,CAAC,OAAO;YAChC;QACF;QAGF,kBAAkB;QAClB,MAAM,eAAe,MAAM,OAAO,gBAAgB,CAAC,KAAK;QACxD,MAAM,eAAe,MAAM,OAAO,gBAAgB,CAAC,QAAQ,CAAC;YAC1D,UAAU;gBAAC;aAAU;QACvB;QAEA,sCAAsC;QACtC,MAAM,eAAe,IAAI;QACzB,aAAa,OAAO,CAAC,aAAa,OAAO,KAAK;QAE9C,MAAM,gBAAgB,MAAM,OAAO,gBAAgB,CAAC,QAAQ,CAAC;YAC3D,OAAO;gBACL,YAAY;oBACV,KAAK;gBACP;YACF;YACA,SAAS;gBACP,YAAY;YACd;QACF;QAEA,mBAAmB;QACnB,MAAM,eAAe,cAAc,MAAM,CAAC,CAAC,KAAU;YACnD,MAAM,MAAM,OAAO,UAAU,CAAC,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;YACzD,GAAG,CAAC,IAAI,GAAG,CAAC,GAAG,CAAC,IAAI,IAAI,CAAC,IAAI;YAC7B,OAAO;QACT,GAAG,CAAC;QAEJ,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACvB,WAAW;YACX;YACA,cAAc,aAAa,MAAM;YACjC;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACvB,WAAW,EAAE;YACb,cAAc;YACd,cAAc;YACd,cAAc,CAAC;QACjB,GAAG;YAAE,QAAQ;QAAI;IACnB;AACF","debugId":null}}]
}